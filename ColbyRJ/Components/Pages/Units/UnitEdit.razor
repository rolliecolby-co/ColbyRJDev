@page "/unit/edit/{unitId:int}"
@rendermode InteractiveServer

@layout PostEditLayout

@inject IHttpContextAccessor httpContext
@inject IUnitRepository unitRepository
@inject IAppUserRepository appUserRepository
@inject NavigationManager navManager
@attribute [Authorize]

<div class="row">
    <div class="col">
        <HeadingC Text="Edit Military Unit" />
    </div>
</div>

<EditForm Model="@Unit" OnValidSubmit="UpdateUnit">
    <DataAnnotationsValidator />

    <div class="row mt-3">
        <div class="col">
            <div class="row">
                <div class="col">
                    <div class="form-group ">
                        <label>For Whom</label>
                        <div class="divDisabled">
                            @Unit.Who
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group mt-2">
                        <label>Start Date</label>
                        <div>
                            <InputDate @bind-Value="@Unit.StartDate" class="form-control" />
                            <ValidationMessage For="@(() => Unit.StartDate)" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col">
                    <label>When</label>
                    <div class="divDisabled">
                        @Unit.YearMonth
                    </div>
                </div>
                <div class="col">
                    <div class="p-3 text-center">
                        <a href="yearMon/edit/unit/@Unit.Id" class="btnEdit">Edit Year Month</a>
                    </div>
                </div>
            </div>
            <div class="row mt-2">
                <div class="col">
                    <div class="form-group mt-2">
                        <label>Unit</label>
                        <div>
                            <InputText @bind-Value="@Unit.MilitaryUnit" class="form-control" />
                            <ValidationMessage For="@(() => Unit.MilitaryUnit)" />
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group mt-2">
                        <label>Unit Location</label>
                        <div>
                            <InputText @bind-Value="@Unit.UnitLocation" class="form-control" />
                            <ValidationMessage For="@(() => Unit.UnitLocation)" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col">
                    @if (Unit.Comments != null)
                    {
                        <div class="divDisabled">
                            @Unit.Comments.Count Comment(s)
                        </div>

                        @if (Unit.Comments.Count > 0)
                        {
                            <div class="mt-3 text-center">
                                <a href="unitComments/@Unit.Id" class="btnReview">Review Comments</a>
                            </div>
                        }
                    }
                </div>
                <div class="col">
                    <div class="text-center">
                        <button type="submit" class="btnUpdate">
                            Update Military Unit
                        </button>
                        <a href="units" class="btnReturn ms-3">Return</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-5">
            <div class="form-group">
                <label>Remarks</label>
                <RZHtmlEditorMinC @bind-HtmlValue="@Unit.Remarks" Height="500px" />
            </div>
            <div class="alert alert-info mt-2">
                If you would like your long narrative displayed in 2 columns,
                enter newColumn in a new paragraph at the desired column break point.
                <br />
                And if you would like the narrative displayed in 3 columns,
                enter newColumn again in a new paragraph at the desired column break point.
            </div>
        </div>
    </div>
</EditForm>


@code {
    [Parameter] public int UnitId { get; set; }
    List<WhoDTO> who = new List<WhoDTO>();
    UnitDTO Unit = new UnitDTO();

    protected override async Task OnParametersSetAsync()
    {
        var unit = await unitRepository.GetUnit(UnitId);
        Unit = unit;

        var tWho = await appUserRepository.GetWho("ind");
        who = tWho.ToList();
    }

    private async Task UpdateUnit()
    {
        var addResult = await unitRepository.Update(Unit);
        navManager.NavigateTo("units");
    }
}
