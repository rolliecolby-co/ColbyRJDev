@page "/whoAmI/edit/{whoAmIId:int}"
@rendermode InteractiveServer

@layout PostEditLayout

@inject IWhoAmIRepository whoAmIRepository
@inject NavigationManager navManager
@attribute [Authorize]

<div class="row ">
    <div class="col">
        <HeadingC Text="Edit Who Am I" />
    </div>
</div>

<div class="row mt-3">
    <div class="col">
        <EditForm Model="WhoAmI" OnValidSubmit="UpdateWhoAmI">
            <DataAnnotationsValidator />

            <div class="row">
                <div class="col">
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label>Title</label>
                                <InputText @bind-Value="WhoAmI.Title" class="form-control"></InputText>
                                <ValidationMessage For="() => WhoAmI.Title"></ValidationMessage>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col">
                            <div class="form-group mt-2">
                                <label>Order #</label>
                                <InputNumber @bind-Value="WhoAmI.OrderBy" class="form-control"></InputNumber>
                            </div>
                            <div class="form-group mt-3 text-center">
                                <button class="btnUpdate">Update</button>
                                <a href="whoAmIs" class="btnReturn">Return</a>
                            </div>
                        </div>
                        <div class="col">
                            <div class="mt-2">
                                <InputFileAudioW WhoAmI="WhoAmI" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-5">
                    <div class="form-group">
                        <label><b>Remarks</b></label>
                        <RZHtmlEditorMinC @bind-HtmlValue="@WhoAmI.Remarks" Height="600px" />
                        <ValidationMessage For="() => WhoAmI.Remarks"></ValidationMessage>
                    </div>
                </div>
            </div>

        </EditForm>
    </div>
</div>

@code {
    [Parameter] public int WhoAmIId { get; set; }
    private WhoAmIDTO WhoAmI { get; set; } = new WhoAmIDTO();
    public bool IsLoading { get; set; } = true;

    protected override async Task OnParametersSetAsync()
    {
        var whoAmI = await whoAmIRepository.GetWhoAmI(WhoAmIId);
        WhoAmI = whoAmI;
        IsLoading = false;
    }

    private async Task UpdateWhoAmI()
    {
        var response = await whoAmIRepository.Update(WhoAmI);
        navManager.NavigateTo("whoAmIs");
    }
}
